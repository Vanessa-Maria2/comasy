<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link rel="stylesheet" type="text/css" th:href="@{/webjars/bootstrap/4.5.0/css/bootstrap.min.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/css/login.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/css/constants.css}"/>

    <!-- Inclui a folha de estilo correta com base no systemType -->
    <link rel="stylesheet" type="text/css"
          th:href="@{${#strings.concat('/css/', @environment.getProperty('systemType'), '-palette.css')}}" />
</head>
<body>
<div class="container" style="margin: 5%;">
    <div class="logo">
        <img th:src="@{/img/logo-building.svg}" alt="Logo">
        <h3 class="title" th:text="${systemType == 'condominium' ? 'Gerenciador de Condomínio' :
                                   (systemType == 'hostel' ? 'Gerenciador de Hostel' : 'Gerenciador de República')}"></h3>
    </div>
    <div class="login-form">
        <div id="alertContainer"></div>
        <form id="loginForm">
            <div class="form-group">
                <label for="username">Usuário:</label>
                <input type="text" class="form-control" id="username" name="username">
            </div>
            <div class="form-group">
                <label for="password">Senha:</label>
                <input type="password" class="form-control" id="password" name="password">
            </div>
            <button type="button" class="btn btn-primary btn-block" id="loginButton">Entrar</button>
        </form>
    </div>
</div>

<script th:src="@{/webjars/jquery/3.7.1/jquery.min.js}"></script>
<script th:src="@{/webjars/bootstrap/4.5.0/js/bootstrap.min.js}"></script>
<script>
    $(document).ready(function() {
        $('#loginButton').click(function () {
            submitLogin();
        });

        $('#loginForm').on('keydown', function (event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                submitLogin();
            }
        });

        function submitLogin() {
            var username = $('#username').val();
            var password = $('#password').val();

            $.ajax({
                url: '/auth/login',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({username: username, password: password}),
                success: function () {
                    showAlert('Login successful');
                    window.location.href = '/reception/view';
                },
                error: function (response) {
                    let errorMessage = 'An unknown error occurred';
                    if (response.responseJSON && response.responseJSON.message) {
                        errorMessage = response.responseJSON.message;
                    }
                    showAlert(errorMessage, 'danger');
                }
            });
        }
    });

        function showAlert(message, type = 'success') {
        const alertContainer = document.getElementById('alertContainer');
        const alertClass = 'alert-' + type;
        const alert = `
            <div class="alert ${alertClass} alert-dismissible fade show" role="alert">
                ${message}
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
        `;
        alertContainer.innerHTML = alert;
    }
</script>
</body>
</html>
